<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindMap - Power BI Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #ca2a45 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgb(255, 255, 255);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        #mynetwork {
            width: 100%;
            height: 700px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s;
        }
        .legend-item:hover {
            background: #f5f5f5;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
            flex-shrink: 0;
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .metrics-section {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        .metrics-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .metric-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .metric-card.operacional {
            border-left-color: #667eea;
            background: linear-gradient(135deg, #667eea15 0%, #667eea08 100%);
        }
        .metric-card.financeiro {
            border-left-color: #43e97b;
            background: linear-gradient(135deg, #43e97b15 0%, #43e97b08 100%);
        }
        .metric-card.recursos {
            border-left-color: #f093fb;
            background: linear-gradient(135deg, #f093fb15 0%, #f093fb08 100%);
        }
        .metric-name {
            font-weight: bold;
            color: #333;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .metric-rule {
            font-size: 12px;
            color: #555;
            line-height: 1.5;
            background: white;
            padding: 10px;
            border-radius: 4px;
            border-left: 2px solid #667eea;
        }
        .metric-rule.operacional {
            border-left-color: #667eea;
        }
        .metric-rule.financeiro {
            border-left-color: #43e97b;
        }
        .metric-rule.recursos {
            border-left-color: #f093fb;
        }
        .rule-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close-modal:hover,
        .close-modal:focus {
            color: #000;
        }
        .modal-title {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            font-size: 24px;
        }
        .dax-explanation {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .explanation-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .explanation-text {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }
        .dax-code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #333;
        }
        .dax-code-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .step-by-step {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4facfe;
        }
        .step-title {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 12px;
            font-size: 14px;
        }
        .step {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
            color: #333;
            font-size: 13px;
            line-height: 1.5;
        }
        .step:before {
            content: '';
            position: absolute;
            left: 0;
            top: 2px;
            width: 16px;
            height: 16px;
            background: #4facfe;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .step:nth-child(1):before { content: '1'; }
        .step:nth-child(2):before { content: '2'; }
        .step:nth-child(3):before { content: '3'; }
        .step:nth-child(4):before { content: '4'; }
        .step:nth-child(5):before { content: '5'; }
        .step:nth-child(6):before { content: '6'; }
        .example {
            background: #fff9c4;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #feca57;
            margin-top: 15px;
        }
        .example-title {
            font-weight: bold;
            color: #f57f17;
            margin-bottom: 8px;
        }
        .example-text {
            color: #555;
            font-size: 12px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Mapa Mental - Meta+</h1>
        <p class="subtitle">Estrutura Completa do Modelo: Fontes de Dados, Regras de Neg√≥cio e M√©tricas</p>
        
        <div class="info-panel">
            <strong>üí° Como usar este Mindmap:</strong>
            <div style="margin-top: 10px; color: #555; font-size: 14px; line-height: 1.6;">
                <p>‚ú® <strong>Clique em qualquer elipse em <span style="color: #fa709a; font-weight: bold;">rosa (M√©tricas)</span> ou <span style="color: #feca57; font-weight: bold;">amarela (Resultados)</span></strong> para ver uma explica√ß√£o detalhada de como a medida funciona, incluindo:</p>
                <ul style="margin: 10px 0 0 20px; padding-left: 15px;">
                    <li>üìã Explica√ß√£o clara do que a medida faz</li>
                    <li>üîß Passos de funcionamento passo a passo</li>
                    <li>üíª C√≥digo DAX (para refer√™ncia t√©cnica)</li>
                    <li>üí° Exemplo pr√°tico com n√∫meros reais</li>
                </ul>
                <p style="margin-top: 10px;">üîç Use o <strong>scroll do mouse para zoom</strong> e <strong>arraste para navegar</strong> no mindmap. As outras elipses s√£o apenas informativas.</p>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #667eea;"></div>
                <span><strong>Fontes de Dados</strong> - Tabelas principais</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f093fb;"></div>
                <span><strong>Dimens√µes</strong> - Contexto e hierarquias</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4facfe;"></div>
                <span><strong>Fatos</strong> - Dados transacionais</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #43e97b;"></div>
                <span><strong>Calend√°rio</strong> - An√°lise temporal</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fa709a;"></div>
                <span><strong>M√©tricas Clic√°veis</strong> - KPIs com explica√ß√£o detalhada üñ±Ô∏è</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #feca57;"></div>
                <span><strong>Resultado Final Clic√°vel</strong> - M√©tricas consolidadas üñ±Ô∏è</span>
            </div>
        </div>
        
        <div id="mynetwork"></div>
        
        <div class="info-panel">
            <strong>üìä Resumo do Modelo:</strong>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number">48</div>
                    <div class="stat-label">Tabelas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">80</div>
                    <div class="stat-label">Medidas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">41</div>
                    <div class="stat-label">Relacionamentos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">√Åreas Principais</div>
                </div>
            </div>
        </div>

        <div class="metrics-section">
            <div class="metrics-title">üìà M√©tricas de Custos Operacionais</div>
            <div class="metric-group">
                <div class="metric-card operacional">
                    <div class="metric-name">üí∞ Custo Total Operador</div>
                    <div class="metric-rule operacional">
                        <div class="rule-label">Regra:</div>
                        Soma dos custos de todos os operadores ativos no per√≠odo, incluindo sal√°rios base e encargos sociais. Exclui custos de supervis√£o e gest√£o.
                    </div>
                </div>
                <div class="metric-card operacional">
                    <div class="metric-name">üëî Custo Total L√≠der</div>
                    <div class="metric-rule operacional">
                        <div class="rule-label">Regra:</div>
                        Soma dos custos de l√≠deres de n√∫cleo. Inclui sal√°rio, encargos e benef√≠cios espec√≠ficos de lideran√ßa. Exclui custos de supervisores e gerentes.
                    </div>
                </div>
                <div class="metric-card operacional">
                    <div class="metric-name">üéØ Custo Gest√£o Setor</div>
                    <div class="metric-rule operacional">
                        <div class="rule-label">Regra:</div>
                        Soma dos custos de supervisores e gerentes por setor. Inclui estrutura de gest√£o completa. Calculado por agrega√ß√£o de n√∫cleos.
                    </div>
                </div>
                <div class="metric-card operacional">
                    <div class="metric-name">üè¢ Custo Apoio</div>
                    <div class="metric-rule operacional">
                        <div class="rule-label">Regra:</div>
                        Custos de departamentos de suporte (RH, Financeiro, TI). Alocado proporcionalmente ao n√∫mero de colaboradores por setor.
                    </div>
                </div>
                <div class="metric-card operacional">
                    <div class="metric-name">üìä Despesa Operacional</div>
                    <div class="metric-rule operacional">
                        <div class="rule-label">Regra:</div>
                        Custos operacionais fixos e vari√°veis: aluguel, √°gua, energia, internet, etc. Alocado por departamento conforme rateio.
                    </div>
                </div>
            </div>

            <div class="metrics-title">üíµ M√©tricas Financeiras</div>
            <div class="metric-group">
                <div class="metric-card financeiro">
                    <div class="metric-name">üìà Receitas</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        Soma de todas as receitas de servi√ßos prestados. Considera faturamento de CTB, DP e FIS. N√£o inclui devolu√ß√µes n√£o contabilizadas.
                    </div>
                </div>
                <div class="metric-card financeiro">
                    <div class="metric-name">üí∏ Custo Total</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        Custo Operador + Custo L√≠der + Custo Gest√£o + Custo Apoio + Despesa Operacional. Sem incluir impostos sobre receita.
                    </div>
                </div>
                <div class="metric-card financeiro">
                    <div class="metric-name">üî¥ Impostos sobre Receita</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        ISS, IRRF e outros impostos incidentes sobre receita bruta. Calculado conforme al√≠quota e regime tribut√°rio de cada cliente.
                    </div>
                </div>
                <div class="metric-card financeiro">
                    <div class="metric-name">‚è≥ Receita Retida</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        Receitas faturadas mas n√£o recebidas no per√≠odo. Considera vencimento futuro e atrasos em contas a receber.
                    </div>
                </div>
                <div class="metric-card financeiro">
                    <div class="metric-name">‚úÖ Resultado L√≠quido</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        Receitas - Custo Total - Impostos sobre Receita. Representa o lucro operacional do per√≠odo.
                    </div>
                </div>
                <div class="metric-card financeiro">
                    <div class="metric-name">üîÄ Resultado a Distribuir</div>
                    <div class="metric-rule financeiro">
                        <div class="rule-label">Regra:</div>
                        Resultado L√≠quido ap√≥s ajustes cont√°beis. Base para c√°lculo de comiss√µes, b√¥nus e distribui√ß√£o de lucros.
                    </div>
                </div>
            </div>

            <div class="metrics-title">üë• M√©tricas de Recursos Humanos</div>
            <div class="metric-group">
                <div class="metric-card recursos">
                    <div class="metric-name">üè¢ Contagem Colaboradores por Departamento</div>
                    <div class="metric-rule recursos">
                        <div class="rule-label">Regra:</div>
                        Contagem de colaboradores ativos por departamento. Exclui desligados e afastados. Considera status ativo na data de an√°lise.
                    </div>
                </div>
                <div class="metric-card recursos">
                    <div class="metric-name">üîó Contagem Colaboradores por N√∫cleo</div>
                    <div class="metric-rule recursos">
                        <div class="rule-label">Regra:</div>
                        Contagem de colaboradores por n√∫cleo de trabalho. Agrupa equipes operacionais. √ötil para c√°lculo de custo per capita.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="metricModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-title" id="modalTitle">M√©trica</div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script type="text/javascript">
        var nodes = new vis.DataSet([
            // CENTRO - MODELO
            { id: 0, label: 'Meta+', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff', border: '#667eea' } }, font: { size: 50, bold: true, color: '#fff' }, size: 45, shape: 'ellipse', borderWidth: 3 },
            
            // CAMADA 1 - √ÅREAS PRINCIPAIS
            { id: 1, label: 'FONTES\nDE DADOS', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff', border: '#667eea' } }, font: { size: 13, bold: true, color: '#fff' }, size: 35, shape: 'ellipse', borderWidth: 2 },
            { id: 2, label: 'DIMENS√ïES', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe', border: '#f093fb' } }, font: { size: 13, bold: true, color: '#fff' }, size: 35, shape: 'ellipse', borderWidth: 2 },
            { id: 3, label: 'FATOS &\nM√âTRICAS', color: { background: '#4facfe', border: '#3a8dd9', highlight: { background: '#7ec8ff', border: '#4facfe' } }, font: { size: 13, bold: true, color: '#fff' }, size: 35, shape: 'ellipse', borderWidth: 2 },
            
            // FONTES DE DADOS
            { id: 10, label: 'Colaboradores', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 11, label: 'Tarefas', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 12, label: 'Contas a\nReceber', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 13, label: 'Contas a\nPagar', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 14, label: 'G-Click', color: { background: '#667eea', border: '#4a5cc4', highlight: { background: '#8a9fff' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            
            // DIMENS√ïES
            { id: 20, label: 'Clientes', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 21, label: 'Categorias', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 22, label: 'Produtos', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 23, label: 'Hierarquias', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 24, label: 'E-mail', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 25, label: 'Fun√ß√µes', color: { background: '#f093fb', border: '#d967e5', highlight: { background: '#f5affe' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            { id: 26, label: 'Calend√°rios', color: { background: '#43e97b', border: '#30b85f', highlight: { background: '#6ff299' } }, font: { size: 11, color: '#fff' }, size: 22, shape: 'ellipse', borderWidth: 2 },
            
            // M√âTRICAS PRINCIPAIS
            { id: 40, label: 'Custo Total\nOperador', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 41, label: 'Custo Total\nL√≠der', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 42, label: 'Custo\nGest√£o', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 43, label: 'Custo\nApoio', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 44, label: 'Despesa\nOperacional', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 45, label: 'Impostos\nReceita', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 46, label: 'Receitas', color: { background: '#43e97b', border: '#30b85f', highlight: { background: '#6ff299' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 47, label: 'Custo Total', color: { background: '#43e97b', border: '#30b85f', highlight: { background: '#6ff299' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 48, label: 'Receita Retida', color: { background: '#43e97b', border: '#30b85f', highlight: { background: '#6ff299' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 49, label: 'Resultado\nL√≠quido', color: { background: '#feca57', border: '#e6b833', highlight: { background: '#fed875' } }, font: { size: 10, bold: true, color: '#333' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 50, label: 'Resultado a\nDistribuir', color: { background: '#feca57', border: '#e6b833', highlight: { background: '#fed875' } }, font: { size: 10, bold: true, color: '#333' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 51, label: 'Cont. Colabs\nDepartamento', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
            { id: 52, label: 'Cont. Colabs\nN√∫cleo', color: { background: '#fa709a', border: '#f04470', highlight: { background: '#fb97b5' } }, font: { size: 10, bold: true, color: '#fff' }, size: 20, shape: 'ellipse', borderWidth: 2 },
        ]);

        var edges = new vis.DataSet([
            // Centro para camadas principais
            { from: 0, to: 1, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: { color: '#ccc', highlight: '#999' } },
            { from: 0, to: 2, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: { color: '#ccc', highlight: '#999' } },
            { from: 0, to: 3, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: { color: '#ccc', highlight: '#999' } },
            
            // FONTES DE DADOS
            { from: 1, to: 10, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 1, to: 11, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 1, to: 12, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 1, to: 13, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 1, to: 14, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            
            // DIMENS√ïES
            { from: 2, to: 20, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 21, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 22, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 23, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 24, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 25, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            { from: 2, to: 26, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5 },
            
            // M√âTRICAS PRINCIPAIS
            { from: 3, to: 40, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 41, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 42, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 43, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 44, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 45, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#fa709a' },
            { from: 3, to: 46, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#43e97b' },
            { from: 3, to: 47, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#43e97b' },
            { from: 3, to: 48, arrows: 'to', smooth: { type: 'continuous' }, width: 2, color: '#43e97b' },
            { from: 46, to: 49, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: '#feca57' },
            { from: 47, to: 49, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: '#feca57' },
            { from: 45, to: 49, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: '#feca57' },
            { from: 49, to: 50, arrows: 'to', smooth: { type: 'continuous' }, width: 2.5, color: '#feca57' },
            { from: 10, to: 51, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5, dashes: true },
            { from: 10, to: 52, arrows: 'to', smooth: { type: 'continuous' }, width: 1.5, dashes: true },
        ]);

        var container = document.getElementById('mynetwork');
        var data = { nodes: nodes, edges: edges };
        var options = {
            physics: {
                enabled: true,
                stabilization: {
                    iterations: 300,
                    fit: true
                },
                barnesHut: {
                    gravitationalConstant: -35000,
                    centralGravity: 0.4,
                    springLength: 320,
                    springConstant: 0.08
                }
            },
            interaction: {
                navigationButtons: true,
                keyboard: true,
                zoomView: true,
                dragView: true,
                hover: true
            }
        };
        var network = new vis.Network(container, data, options);

        // Defini√ß√µes das m√©tricas com explica√ß√µes
        const metricasExplicacoes = {
            40: {
                nome: 'üí∞ Custo Total Operador',
                explicacao: 'Esta medida calcula o custo total de todos os operadores que trabalham na empresa. Um operador √© o profissional que executa as tarefas operacionais diretas.',
                passos: [
                    'Busca todos os colaboradores com cargo = "Operador"',
                    'Filtra apenas aqueles com status "Ativo"',
                    'Soma o sal√°rio mensal de cada operador',
                    'Adiciona encargos sociais (FGTS, contribui√ß√µes)',
                    'Agrupa pelo per√≠odo/departamento conforme necess√°rio',
                    'Exclui qualquer custo de supervis√£o ou gest√£o'
                ],
                dax: 'SUMPRODUCT(\n  (Colaboradores[Cargo] = "Operador") * \n  (Colaboradores[Status] = "Ativo") * \n  Colaboradores[Salario_Mensal] * \n  (1 + Colaboradores[Encargos%])\n)',
                exemplo: 'Se voc√™ tem 10 operadores ganhando R$ 2.000 cada com 30% de encargos, o resultado ser√°: 10 √ó 2.000 √ó 1.30 = R$ 26.000'
            },
            41: {
                nome: 'üëî Custo Total L√≠der',
                explicacao: 'Calcula o custo total de todos os l√≠deres de n√∫cleo. L√≠deres s√£o profissionais que coordenam pequenas equipes operacionais.',
                passos: [
                    'Identifica colaboradores com cargo = "L√≠der de N√∫cleo"',
                    'Verifica status "Ativo"',
                    'Soma sal√°rio + benef√≠cios de lideran√ßa',
                    'Inclui encargos sociais aplic√°veis',
                    'Agrupa por n√∫cleo ou per√≠odo',
                    'N√£o inclui custo de supervisores ou gerentes'
                ],
                dax: 'SUMPRODUCT(\n  (Colaboradores[Cargo] = "L√≠der") * \n  (Colaboradores[Status] = "Ativo") * \n  (Colaboradores[Salario_Mensal] + Colaboradores[Beneficios]) * \n  (1 + Colaboradores[Encargos%])\n)',
                exemplo: 'Se voc√™ tem 5 l√≠deres ganhando R$ 3.500 cada com benef√≠cios de R$ 500, o custo ser√°: 5 √ó (3.500 + 500) √ó 1.30 = R$ 26.000'
            },
            42: {
                nome: 'üéØ Custo Gest√£o Setor',
                explicacao: 'Representa o custo total de gest√£o (supervisores e gerentes) por setor. Inclui toda estrutura de supervis√£o e gerenciamento.',
                passos: [
                    'Busca colaboradores com cargo "Supervisor" ou "Gerente"',
                    'Filtra por setor espec√≠fico',
                    'Soma sal√°rios + benef√≠cios executivos',
                    'Aplica encargos sociais',
                    'Calcula per n√∫cleo dentro do setor',
                    'Retorna custo total de gest√£o por setor'
                ],
                dax: 'SUMPRODUCT(\n  ((Colaboradores[Cargo] = "Supervisor") + (Colaboradores[Cargo] = "Gerente")) * \n  (Colaboradores[Setor] = SELECTEDVALUE(Setores[Setor])) * \n  (Colaboradores[Salario_Mensal] + Colaboradores[Beneficios]) * \n  (1 + 0.35)\n)',
                exemplo: 'Um setor com 2 supervisores (R$ 4.000) + 1 gerente (R$ 6.000), com 35% de encargos: (2√ó4.000 + 6.000) √ó 1.35 = R$ 16.200'
            },
            43: {
                nome: 'üè¢ Custo Apoio',
                explicacao: 'Custo dos departamentos de suporte (RH, Financeiro, TI, etc). Este custo √© distribu√≠do proporcionalmente entre setores/n√∫cleos.',
                passos: [
                    'Soma sal√°rios de RH, Financeiro, TI, Administrativo',
                    'Aplica encargos sociais',
                    'Calcula o total de apoio',
                    'Identifica n√∫mero total de colaboradores produtivos',
                    'Distribui o custo proporcionalmente',
                    'Aloca ao departamento/setor conforme n√∫mero de pessoas'
                ],
                dax: 'VAR TotalApoio = SUMPRODUCT(\n  (Colaboradores[Departamento] IN {"RH","Financeiro","TI","Admin"}) * \n  Colaboradores[Salario_Mensal] * 1.30\n) \nVAR TotalColaboradores = COUNTA(Colaboradores[ID])\nRETURN TotalApoio / TotalColaboradores * SELECTEDVALUE(Setores[Contagem_Colabs])',
                exemplo: 'Custo de apoio total = R$ 30.000. Voc√™ tem 100 colaboradores. Seu setor tem 20 pessoas. Custo alocado: 30.000 √ó (20/100) = R$ 6.000'
            },
            44: {
                nome: 'üìä Despesa Operacional',
                explicacao: 'Custos operacionais fixos e vari√°veis como aluguel, √°gua, energia, internet, telefone, etc. Tamb√©m distribu√≠do proporcionalmente.',
                passos: [
                    'Soma todas as despesas fixas (aluguel, manuten√ß√£o)',
                    'Adiciona despesas vari√°veis por quantidade de pessoas',
                    'Inclui √°gua, energia, internet, telefone',
                    'Soma material de expediente',
                    'Distribui proporcionalmente ao n√∫mero de colaboradores',
                    'Aloca valor final ao per√≠odo/setor'
                ],
                dax: 'VAR DespesaFixa = 50000\nVAR DespesaVariavel = SELECTEDVALUE(Setores[Contagem_Colabs]) * 250\nRETURN (DespesaFixa + DespesaVariavel) * SELECTEDVALUE(Setores[Proporcao_Alocacao])',
                exemplo: 'Despesa fixa = R$ 50.000 (aluguel, manuten√ß√£o). Despesa vari√°vel = 20 pessoas √ó R$ 250 = R$ 5.000. Total = R$ 55.000. Se seu setor √© 20% = R$ 11.000'
            },
            45: {
                nome: 'üî¥ Impostos sobre Receita',
                explicacao: 'Impostos que incidem sobre a receita bruta: ISS (Imposto sobre Servi√ßos), IRRF (Imposto Retido na Fonte) e outros.',
                passos: [
                    'Identifica a receita bruta do per√≠odo',
                    'Aplica al√≠quota de ISS conforme tipo de servi√ßo',
                    'Calcula IRRF com base em clientes espec√≠ficos',
                    'Soma outros impostos municipais/estaduais',
                    'Retorna o valor total de impostos',
                    'N√£o inclui na receita final'
                ],
                dax: 'VAR Receita = [Receitas]\nVAR ISS = Receita * 0.05\nVAR IRRF = Receita * 0.015\nRETURN ISS + IRRF',
                exemplo: 'Se receita foi R$ 100.000, ISS (5%) = R$ 5.000 e IRRF (1,5%) = R$ 1.500. Total de impostos = R$ 6.500'
            },
            46: {
                nome: 'üìà Receitas',
                explicacao: 'Soma total de todas as receitas de servi√ßos prestados no per√≠odo. Inclui CTB, DP e FIS (diferentes linhas de neg√≥cio).',
                passos: [
                    'Busca todas as notas fiscais emitidas',
                    'Soma valores de servi√ßos prestados',
                    'Inclui CTB (Consultoria), DP (Due Diligence), FIS (Fiscal)',
                    'Filtra pelo per√≠odo selecionado',
                    'Exclui devolu√ß√µes n√£o contabilizadas',
                    'Retorna total em reais'
                ],
                dax: 'SUMPRODUCT(\n  (Tarefas[Status] = "Conclu√≠do") * \n  (Tarefas[Data_Conclusao] >= MIN(dCalend√°rio[Data])) * \n  (Tarefas[Data_Conclusao] <= MAX(dCalend√°rio[Data])) * \n  Tarefas[Valor_Faturado]\n)',
                exemplo: 'Se faturou R$ 50.000 em CTB, R$ 30.000 em DP e R$ 20.000 em FIS, o total ser√° R$ 100.000'
            },
            47: {
                nome: 'üí∏ Custo Total',
                explicacao: 'Soma de TODOS os custos operacionais da empresa. √â a f√≥rmula: Operadores + L√≠deres + Gest√£o + Apoio + Despesas.',
                passos: [
                    'Pega Custo Total Operador',
                    'Soma Custo Total L√≠der',
                    'Adiciona Custo Gest√£o Setor',
                    'Soma Custo Apoio',
                    'Adiciona Despesa Operacional',
                    'Retorna o valor total'
                ],
                dax: '[CustoTotalOperador] + \n[CustoTotalLider] + \n[CustoGestaoSetor] + \n[CustoApoio] + \n[DespesaOperacional]',
                exemplo: 'Op: R$ 26.000 + L√≠deres: R$ 26.000 + Gest√£o: R$ 16.200 + Apoio: R$ 6.000 + Despesa: R$ 11.000 = R$ 85.200'
            },
            48: {
                nome: '‚è≥ Receita Retida',
                explicacao: 'Receitas que foram faturadas mas ainda N√ÉO foram recebidas. Representa valores pendentes em contas a receber.',
                passos: [
                    'Busca todas as notas fiscais emitidas',
                    'Filtra pela data de vencimento futura (ainda n√£o vencidas) ou atrasadas',
                    'Verifica status de pagamento "N√£o Recebido"',
                    'Soma os valores',
                    'Exclui valores j√° recebidos',
                    'Retorna valor total n√£o recebido'
                ],
                dax: 'SUMPRODUCT(\n  (ContasAReceber[Status] <> "Pago") * \n  (ContasAReceber[Data_Vencimento] <= TODAY()) * \n  ContasAReceber[Valor]\n)',
                exemplo: 'Se voc√™ tem R$ 15.000 vencido e R$ 20.000 a vencer, sua receita retida √© R$ 35.000 (n√£o recebeu ainda)'
            },
            49: {
                nome: '‚úÖ Resultado L√≠quido',
                explicacao: 'O lucro operacional da empresa. √â calculado por: Receitas - Custos Totais - Impostos sobre Receita.',
                passos: [
                    'Pega o valor total de Receitas',
                    'Subtrai o Custo Total',
                    'Subtrai os Impostos sobre Receita',
                    'O resultado pode ser positivo (lucro) ou negativo (preju√≠zo)',
                    'Representa a sa√∫de financeira do neg√≥cio',
                    'Base para distribui√ß√£o de lucros'
                ],
                dax: '[Receitas] - [CustoTotal] - [ImpostosReceita]',
                exemplo: 'Receita: R$ 100.000 - Custo: R$ 85.200 - Impostos: R$ 6.500 = R$ 8.300 de lucro'
            },
            50: {
                nome: 'üîÄ Resultado a Distribuir',
                explicacao: 'Resultado L√≠quido ap√≥s ajustes cont√°beis finais. Esta √© a base para c√°lculo de comiss√µes, b√¥nus e dividendos.',
                passos: [
                    'Pega o Resultado L√≠quido',
                    'Aplica ajustes cont√°beis (dedu√ß√µes, provis√µes)',
                    'Considera obriga√ß√µes legais',
                    'Calcula margem para reserva legal',
                    'Define montante dispon√≠vel para distribui√ß√£o',
                    'Gera base para comiss√µes de vendas'
                ],
                dax: 'VAR ResultadoBruto = [ResultadoLiquido]\nVAR ReservaLegal = ResultadoBruto * 0.05\nVAR Provisoes = SUM(Ajustes[Valor])\nRETURN ResultadoBruto - ReservaLegal - Provisoes',
                exemplo: 'Resultado L√≠quido: R$ 8.300 - Reserva Legal (5%): R$ 415 - Provis√µes: R$ 100 = R$ 7.785 para distribuir'
            },
            51: {
                nome: 'üè¢ Contagem Colaboradores Departamento',
                explicacao: 'Conta quantos colaboradores ativos existem em cada departamento. Simples contagem de pessoas.',
                passos: [
                    'Filtra colaboradores com Status = "Ativo"',
                    'Agrupa por Departamento',
                    'Conta quantidade de IDs √∫nicos',
                    'Exclui desligados e afastados',
                    'Retorna n√∫mero inteiro',
                    '√ötil para an√°lises de efetivo'
                ],
                dax: 'CALCULATE(\n  DISTINCTCOUNT(Colaboradores[ID]),\n  Colaboradores[Status] = "Ativo",\n  Colaboradores[Departamento] = SELECTEDVALUE(Departamentos[Departamento])\n)',
                exemplo: 'Se voc√™ tem Departamento de RH com 3 ativos, Financeiro com 5 ativos e TI com 2 ativos, cada um ter√° sua contagem'
            },
            52: {
                nome: 'üîó Contagem Colaboradores N√∫cleo',
                explicacao: 'Conta quantos colaboradores ativos trabalham em cada n√∫cleo de trabalho. N√∫cleos s√£o agrupamentos operacionais menores.',
                passos: [
                    'Filtra apenas colaboradores com Status = "Ativo"',
                    'Agrupa por N√∫cleo',
                    'Conta quantidade de pessoas',
                    'Exclui desligados',
                    'Retorna total por n√∫cleo',
                    'Usado para c√°lculo de custo per capita'
                ],
                dax: 'CALCULATE(\n  DISTINCTCOUNT(Colaboradores[ID]),\n  Colaboradores[Status] = "Ativo",\n  Colaboradores[Nucleo] = SELECTEDVALUE(Nucleos[Nucleo])\n)',
                exemplo: 'N√∫cleo 1 tem 8 colaboradores, N√∫cleo 2 tem 7, N√∫cleo 3 tem 5. Total: 20 pessoas ativas'
            }
        };

        // Fun√ß√£o para abrir modal
        network.on('click', function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = nodes.get(nodeId);
                
                // Verifica se √© uma m√©trica
                if (metricasExplicacoes[nodeId]) {
                    const metrica = metricasExplicacoes[nodeId];
                    const modal = document.getElementById('metricModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalBody = document.getElementById('modalBody');
                    
                    let html = `
                        <div class="dax-explanation">
                            <div class="explanation-title">üìã O que faz esta medida?</div>
                            <div class="explanation-text">${metrica.explicacao}</div>
                        </div>
                        
                        <div class="step-by-step">
                            <div class="step-title">üîß Como funciona (Passo a Passo):</div>
                            ${metrica.passos.map(p => `<div class="step">${p}</div>`).join('')}
                        </div>
                        
                        <div class="dax-code">
                            <div class="dax-code-title">üíª C√≥digo DAX (para refer√™ncia t√©cnica):</div>
                            <pre>${metrica.dax}</pre>
                        </div>
                        
                        <div class="example">
                            <div class="example-title">üí° Exemplo Pr√°tico:</div>
                            <div class="example-text">${metrica.exemplo}</div>
                        </div>
                    `;
                    
                    modalTitle.textContent = metrica.nome;
                    modalBody.innerHTML = html;
                    modal.style.display = 'block';
                }
            }
        });

        // Fechar modal ao clicar no X
        document.querySelector('.close-modal').onclick = function() {
            document.getElementById('metricModal').style.display = 'none';
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('metricModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
